{% extends "base.html" %}
{% block content %}
<form>
  <button id="start">Start</button>
  <button id="stop">Stop</button>
</form>


<div id="my_dataviz"></div><br>

<div id="slide">
  Cooling <br>
  <input type="range" name="scale" min="0" max="100" value="50" oninput="sliderChange(this.value)">
  <br>
  <span id="slidetest"></span>
</div>

<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<script>
  $(document).ready(function() {

    var stop_id;
    var stop_time;
    var fps = 100;

    namespace = '/heat_sock';
    var socket = io(namespace);

    var margin = {top: 30, right: 30, bottom: 30, left: 30},
      width = 450 - margin.left - margin.right,
      height = 450 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

    // Labels of row and columns
    var myGroups = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J"]
    var myVars = ["v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10"]

    // Build X scales and axis:
    var x = d3.scaleBand()
      .range([ 0, width ])
      .domain(myGroups)
      .padding(0.01);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x))

    // Build X scales and axis:
    var y = d3.scaleBand()
      .range([ height, 0 ])
      .domain(myVars)
      .padding(0.01);
    svg.append("g")
      .call(d3.axisLeft(y));

    // Build color scale
    var myColor = d3.scaleLinear()
      .range(["blue", "yellow"])
      .domain([1,100])

    //Build the heatmap
    socket.on('connect', function() {
      socket.emit('startup', {data: 0});
    })
    socket.on('build_rects', function(data) {
      svg.selectAll()
          .data(data, function(d) { return d.group+':'+d.variable})
          .enter()
          .append("rect")
          .attr("id", function(d) { return d.group+d.variable })
          .attr("x", function(d) { return x(d.group) })
          .attr("y", function(d) { return y(d.variable) })
          .attr("width", x.bandwidth())
          .attr("height", y.bandwidth())
          .style("fill", "white")
    })

    $('button#start').on('click', function(event) {
      document.getElementById("start").disabled = true;
      requestAnimationFrame(runtest)
      return false;
    });

    function runtest() {
      socket.emit('slider', {data: $('input[name="scale"]').val()})
    };

    function update_heatmap(data) {
      stop_time = setTimeout(function(){
        stop_id = requestAnimationFrame(runtest)
        var myColor = d3.scaleLinear()
          .range(["blue", "yellow"])
          .domain([1,100]);

        d3.selectAll('rect')
          .data(data)
          .style("fill", function(data) { return myColor(data.value) });
        }, 1000/fps)
  };

    $(" #stop ").click( function() {
      document.getElementById("start").disabled = false;
        cancelAnimationFrame(stop_id);
    });

    socket.on('new_heat', function(heat_data) {
      update_heatmap(heat_data)
    });
  })

//Read the data

//Get Slider value
sliderChange = function(n) {
  var e=n;
  $('#slidetest').text("Slider value is: " + e)
}

//Create start/stop buttons for animation


//This updates the heatmap color values







</script>

{% endblock %}
